<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preoperative Surgical Oncology Case Conference Charter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@600;700&family=Quattrocento&display=swap" rel="stylesheet">
    <!--
    Narrative & Structure Plan:
    The infographic visually translates the formal charter into a digestible narrative. It starts with the high-level mission, identifies the key learning objectives for participants, details the roles and workflow in a clear process-oriented section, and finally breaks down the meeting's structure using quantitative charts. A new AI-powered section provides practical tools for case preparation. The flow guides the user from the "why" to the "what," "who," "how," and now "how to prepare" for the conference.

    Color Palette Chosen: ECU Institutional - Purple: #592A8A, Dark Purple: #41215E, Gold: #FEC923, Dark Magenta: #77216F, Grey: #6C6D68, Teal: #00818F.

    Visualization Selection & Justification:
    1.  Data: Conference Duration (60 mins) -> Goal: Inform -> Visualization: Single Big Number.
    2.  Data: Conference Objectives -> Goal: Organize -> Visualization: Styled Info Cards.
    3.  Data: Participant Roles & Responsibilities -> Goal: Compare/Organize -> Visualization: Three-column layout.
    4.  Data: Weekly Conference Workflow -> Goal: Organize (Process) -> Visualization: Custom Flowchart.
    5.  Data: Meeting Agenda Time Allocation -> Goal: Compare (Composition) -> Visualization: Donut Chart (Chart.js/Canvas).
    6.  Data: Core Case Discussion Points -> Goal: Compare (Attributes) -> Visualization: Radar Chart (Chart.js/Canvas).
    7.  Feature: AI Case Prep -> Goal: Assist -> Visualization: Interactive Form with Gemini API integration.

    Final Confirmation: NEITHER Mermaid JS NOR SVG were used anywhere in the output. All visuals are pure HTML/CSS or rendered on HTML Canvas elements by Chart.js.
    -->
    <style>
        body {
            font-family: 'Quattrocento', serif;
            background-color: #41215E; /* Dark Purple */
            color: #FFFFFF;
        }
        h1, h2, h3, h4, .font-headline {
             font-family: 'Oswald', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .card {
            background-color: #592A8A; /* Purple */
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
            border: 1px solid #77216F; /* Dark Magenta */
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .flowchart-step {
            background-color: #592A8A; /* Purple */
            border: 1px solid #77216F; /* Dark Magenta */
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            flex-grow: 1;
        }
        .flowchart-arrow {
            font-size: 2.5rem;
            color: #FEC923; /* Gold */
            line-height: 1;
            align-self: center;
        }
        .ai-assistant-container {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid #592A8A;
            border-radius: 0.75rem;
            padding: 2rem;
        }
        .ai-input, .ai-output {
            background-color: #41215E;
            color: #FFFFFF;
            border: 1px solid #77216F;
            border-radius: 0.5rem;
            padding: 1rem;
            width: 100%;
        }
        .ai-button {
            background-color: #FEC923;
            color: #41215E;
            font-family: 'Oswald', sans-serif;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
        }
        .ai-button:hover {
            background-color: #EAC01E;
        }
        .ai-button:disabled {
            background-color: #6C6D68;
            color: #A9A9A9;
            cursor: not-allowed;
        }
        .loader {
            border: 4px solid #592A8A;
            border-top: 4px solid #FEC923;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-white mb-4 font-headline">Preoperative Surgical Oncology Conference</h1>
            <p class="text-xl md:text-2xl text-gray-200 font-light">A Visual Charter for Excellence in Surgical Planning & Education</p>
        </header>

        <main>
            <section id="mission" class="mb-20">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                    <div class="md:col-span-2">
                        <h2 class="text-3xl font-bold mb-4 text-[#FEC923] font-headline">Our Mission</h2>
                        <p class="text-lg text-gray-200">
                            To provide a structured, educational forum for the review of upcoming surgical oncology cases. Our primary purpose is to enhance patient safety, optimize surgical planning, and foster a collaborative learning environment for all participants.
                        </p>
                    </div>
                    <div class="card text-center flex flex-col justify-center items-center p-8 bg-[#00818F]">
                        <span class="text-7xl font-black text-white font-headline">60</span>
                        <span class="text-2xl font-bold text-[#FEC923] font-headline">Minutes</span>
                        <p class="text-gray-200 mt-2">Every Friday at 4:00 PM dedicated to collaborative case review.</p>
                    </div>
                </div>
            </section>

            <section id="ai-assistant" class="mb-20">
                <h2 class="text-3xl font-bold text-center mb-10 text-[#FEC923] font-headline">AI-Powered Case Prep Assistant</h2>
                <div class="ai-assistant-container max-w-4xl mx-auto">
                    <p class="text-center text-gray-300 mb-6">Use the tools below to accelerate case preparation. Enter key patient data, diagnosis, and the planned procedure, then let the AI assistant help you build a presentation or formulate discussion points.</p>
                    <div class="mb-4">
                        <label for="caseDetails" class="block mb-2 font-bold font-headline text-lg">Case Details:</label>
                        <textarea id="caseDetails" class="ai-input" rows="6" placeholder="Example: 58 y/o male with a 4cm mass in the pancreatic head, biopsy-proven adenocarcinoma. Plan for Whipple procedure. No distant metastatic disease on imaging..."></textarea>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center mb-6">
                        <button id="generateSummaryBtn" class="ai-button">‚ú® Generate Case Summary</button>
                        <button id="generateQuestionsBtn" class="ai-button">‚ú® Generate Discussion Questions</button>
                    </div>
                    <div id="loaderContainer" class="flex justify-center my-4 hidden">
                        <div class="loader"></div>
                    </div>
                    <div id="aiOutput" class="ai-output min-h-[150px] whitespace-pre-wrap hidden"></div>
                </div>
            </section>

            <section id="objectives" class="mb-20">
                <h2 class="text-3xl font-bold text-center mb-10 text-[#FEC923] font-headline">Core Learning Objectives</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">üéØ</span>Identify Indications</h3>
                        <p class="text-gray-300">Pinpoint key indications and potential contraindications for planned surgical procedures.</p>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">üó∫Ô∏è</span>Describe Anatomy</h3>
                        <p class="text-gray-300">Detail critical anatomic considerations and recognize potential patient-specific variations.</p>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">‚öñÔ∏è</span>Evaluate Approaches</h3>
                        <p class="text-gray-300">Compare different surgical approaches (e.g., open, laparoscopic, robotic) and their rationales.</p>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">üìà</span>Understand Staging</h3>
                        <p class="text-gray-300">Grasp the principles of oncologic staging and its profound impact on the treatment pathway.</p>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">ü§î</span>Anticipate Challenges</h3>
                        <p class="text-gray-300">Formulate plans for potential intraoperative challenges and postoperative care.</p>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-xl mb-3 flex items-center font-headline"><span class="text-2xl mr-3 text-[#FEC923]">üó£Ô∏è</span>Develop Skills</h3>
                        <p class="text-gray-300">Enhance skills in case presentation and the critical appraisal of surgical evidence.</p>
                    </div>
                </div>
            </section>

            <section id="roles-workflow" class="mb-20">
                <h2 class="text-3xl font-bold text-center mb-10 text-[#FEC923] font-headline">Participants & Weekly Workflow</h2>
                <div class="bg-[#592A8A] bg-opacity-50 rounded-lg p-8">
                    <h3 class="text-2xl font-bold text-center mb-8 font-headline">Roles & Responsibilities</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                        <div class="card bg-[#41215E] border-[#77216F]">
                            <h4 class="font-bold text-xl text-center mb-3 text-[#FEC923] font-headline">Medical Students</h4>
                            <ul class="list-disc list-outside text-gray-300 space-y-2 pl-5">
                                <li>Compile weekly case list</li>
                                <li>Include patient data & procedure</li>
                                <li>Distribute list by Wednesday 5 PM</li>
                                <li>Observe and ask questions</li>
                            </ul>
                        </div>
                        <div class="card bg-[#41215E] border-[#77216F]">
                            <h4 class="font-bold text-xl text-center mb-3 text-[#FEC923] font-headline">Surgical Residents</h4>
                            <ul class="list-disc list-outside text-gray-300 space-y-2 pl-5">
                                <li>Review the full case list</li>
                                <li>Select 3 key cases for presentation</li>
                                <li>Prepare and deliver presentations</li>
                                <li>Actively participate in discussion</li>
                            </ul>
                        </div>
                        <div class="card bg-[#41215E] border-[#77216F]">
                            <h4 class="font-bold text-xl text-center mb-3 text-[#FEC923] font-headline">Attending Faculty</h4>
                            <ul class="list-disc list-outside text-gray-300 space-y-2 pl-5">
                                <li>Act as Conference Lead</li>
                                <li>Facilitate case discussions</li>
                                <li>Provide expert opinion & guidance</li>
                                <li>Ensure conference is educational</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-center mb-8 font-headline">The Process Flow</h3>
                    <div class="flex flex-col md:flex-row md:items-stretch md:justify-between gap-4 md:gap-2">
                         <div class="flowchart-step">
                            <p class="font-bold text-lg font-headline">By Wednesday PM</p>
                            <p class="text-sm text-gray-300">Medical Students compile & distribute the weekly case list.</p>
                        </div>
                        <div class="flowchart-arrow transform md:rotate-0 rotate-90">‚Üí</div>
                         <div class="flowchart-step">
                            <p class="font-bold text-lg font-headline">Wed - Friday</p>
                            <p class="text-sm text-gray-300">Residents review the list, select 3 cases, and prepare presentations.</p>
                        </div>
                        <div class="flowchart-arrow transform md:rotate-0 rotate-90">‚Üí</div>
                        <div class="flowchart-step">
                            <p class="font-bold text-lg font-headline">Friday 4:00 PM</p>
                            <p class="text-sm text-gray-300">Conference begins, led by the On-Call Attending Faculty.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="charts" class="mb-12">
                 <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div class="flex flex-col items-center">
                        <h2 class="text-3xl font-bold text-center mb-6 text-[#FEC923] font-headline">Anatomy of the Hour</h2>
                        <p class="text-center text-gray-300 mb-6 max-w-lg">The 60-minute conference is precisely structured to maximize educational value and collaborative discussion.</p>
                        <div class="chart-container">
                            <canvas id="agendaChart"></canvas>
                        </div>
                    </div>
                    <div class="flex flex-col items-center">
                        <h2 class="text-3xl font-bold text-center mb-6 text-[#FEC923] font-headline">Focus of Discussion</h2>
                        <p class="text-center text-gray-300 mb-6 max-w-lg">Each case presentation is a multi-faceted review, ensuring all critical aspects of patient care are thoroughly examined.</p>
                        <div class="chart-container">
                            <canvas id="discussionChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-20 pt-8 border-t border-[#592A8A]">
            <p class="text-gray-400">ECU Division of Surgical Oncology | A Commitment to Collaborative Excellence</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const caseDetailsInput = document.getElementById('caseDetails');
            const generateSummaryBtn = document.getElementById('generateSummaryBtn');
            const generateQuestionsBtn = document.getElementById('generateQuestionsBtn');
            const loaderContainer = document.getElementById('loaderContainer');
            const aiOutput = document.getElementById('aiOutput');
            
            const callGemini = async (prompt) => {
                generateSummaryBtn.disabled = true;
                generateQuestionsBtn.disabled = true;
                aiOutput.classList.add('hidden');
                loaderContainer.classList.remove('hidden');

                const userText = caseDetailsInput.value;
                if (!userText.trim()) {
                    aiOutput.textContent = 'Please enter case details before generating.';
                    aiOutput.classList.remove('hidden');
                    loaderContainer.classList.add('hidden');
                    generateSummaryBtn.disabled = false;
                    generateQuestionsBtn.disabled = false;
                    return;
                }

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt + "\n\n" + userText }] });

                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        aiOutput.textContent = text;
                    } else {
                        aiOutput.textContent = 'Error: Could not retrieve a valid response from the AI. Please try again.';
                        console.error('Unexpected API response structure:', result);
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    aiOutput.textContent = `An error occurred: ${error.message}. Check the console for more details.`;
                } finally {
                    loaderContainer.classList.add('hidden');
                    aiOutput.classList.remove('hidden');
                    generateSummaryBtn.disabled = false;
                    generateQuestionsBtn.disabled = false;
                }
            };
            
            generateSummaryBtn.addEventListener('click', () => {
                const summaryPrompt = "Based on the following surgical oncology case details, generate a concise case summary for a preoperative conference presentation. Structure the summary with these headings: Indication for Surgery, Anatomic Considerations, Proposed Surgical Approach, and Staging Implications.";
                callGemini(summaryPrompt);
            });

            generateQuestionsBtn.addEventListener('click', () => {
                const questionsPrompt = "Based on the following surgical oncology case details, generate 3-5 thought-provoking discussion questions suitable for an attending to ask residents and medical students during a preoperative conference. The questions should probe critical thinking about surgical approach, potential complications, and alternative management strategies.";
                callGemini(questionsPrompt);
            });

            const wrapLabel = (str, maxLen = 16) => {
                if (str.length <= maxLen) {
                    return str;
                }
                const words = str.split(' ');
                const lines = [];
                let currentLine = '';
                for (const word of words) {
                    if ((currentLine + ' ' + word).length > maxLen && currentLine.length > 0) {
                        lines.push(currentLine);
                        currentLine = word;
                    } else {
                        currentLine = currentLine ? currentLine + ' ' + word : word;
                    }
                }
                lines.push(currentLine);
                return lines;
            };
            
            const CHART_TOOLTIP_CONFIG = {
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                if (Array.isArray(label)) {
                                  return label.join(' ');
                                } else {
                                  return label;
                                }
                            }
                        }
                    }
                }
            };

            const institutionalColors = ['#FEC923', '#77216F', '#00818F'];
            
            Chart.defaults.font.family = "'Quattrocento', serif";
            Chart.defaults.color = '#FFFFFF';

            const agendaCtx = document.getElementById('agendaChart');
            if(agendaCtx) {
                new Chart(agendaCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Resident Case Presentations', 'Open Forum & Wrap-up', 'Call to Order'],
                        datasets: [{
                            label: 'Minutes Allocated',
                            data: [45, 10, 5],
                            backgroundColor: institutionalColors,
                            borderColor: '#41215E',
                            borderWidth: 4,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                           ...CHART_TOOLTIP_CONFIG.plugins,
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#FFFFFF',
                                    font: {
                                        size: 14,
                                        family: "'Oswald', sans-serif"
                                    }
                                }
                            }
                        },
                        cutout: '50%'
                    }
                });
            }

            const discussionCtx = document.getElementById('discussionChart');
            if(discussionCtx) {
                new Chart(discussionCtx, {
                    type: 'radar',
                    data: {
                        labels: [
                            wrapLabel('Indication for Surgery'),
                            wrapLabel('Anatomic Considerations'),
                            wrapLabel('Proposed Surgical Approach'),
                            wrapLabel('Staging Implications'),
                            wrapLabel('Postoperative Care Plan')
                        ],
                        datasets: [{
                            label: 'Depth of Review',
                            data: [10, 10, 10, 10, 10],
                            fill: true,
                            backgroundColor: 'rgba(254, 201, 35, 0.3)',
                            borderColor: '#FEC923',
                            pointBackgroundColor: '#FEC923',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#FEC923'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        ...CHART_TOOLTIP_CONFIG,
                        scales: {
                            r: {
                                angleLines: {
                                    color: 'rgba(255, 255, 255, 0.2)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.2)'
                                },
                                pointLabels: {
                                    color: '#FFFFFF',
                                    font: {
                                        size: 12,
                                        family: "'Quattrocento', serif"
                                    }
                                },
                                ticks: {
                                    display: false,
                                    backdropColor: 'transparent',
                                    stepSize: 2
                                }
                            }
                        },
                        plugins: {
                            ...CHART_TOOLTIP_CONFIG.plugins,
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        });
    </script>

</body>
</html>
